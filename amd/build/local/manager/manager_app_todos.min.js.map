{"version":3,"file":"manager_app_todos.min.js","sources":["../../../src/local/manager/manager_app_todos.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Moves wrapping navigation items into a more menu.\n *\n * @module     mod_competvet/local/manager/manager_app_planning\n * @class      competvet\n * @copyright  2024 Bas Brands\n * @author     Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport CompetState from 'mod_competvet/local/competstate';\nimport Repository from 'mod_competvet/local/new-repository';\nimport './todo';\n\n/*\n* A CRUD manager for data.\n*/\nclass Manager {\n\n    /**\n     * Constructor.\n     */\n    constructor() {\n        this.app = document.querySelector('[data-region=\"managetodos\"]');\n        this.cmId = this.app.dataset.cmId;\n        this.userId = this.app.dataset.userId;\n        this.dataset = this.app.region;\n        this.getData();\n        this.addEventListeners();\n    }\n\n    /**\n     * Get the data for this manager.\n     */\n    async getData() {\n        const response = await Repository.getTodos({\n            'userid': this.userId,\n        });\n        if (!response) {\n            return;\n        }\n        CompetState.setData(response);\n        this.toggleEmptyTodos();\n    }\n\n    /**\n     * Hide / Show the data-empty-todos elements.\n     */\n    toggleEmptyTodos() {\n        const state = CompetState.getData();\n        const hasTodos = state.todos.filter((todo) => !todo.deleted).length > 0;\n        this.app.querySelectorAll('[data-empty-todos]').forEach((element) => {\n            element.classList.toggle('d-none', element.getAttribute('data-empty-todos') === String(hasTodos));\n        });\n    }\n\n    /**\n     * Add event listeners to the page.\n     * @return {void}\n     */\n    addEventListeners() {\n        document.addEventListener('click', (e) => {\n            let btn = e.target.closest('[data-button-action]');\n            if (btn) {\n                e.preventDefault();\n                this.actions(btn);\n            }\n        });\n        const radioSelectAll = this.app.querySelector('[data-radio-action=\"selectall\"]');\n        if (radioSelectAll) {\n\n            radioSelectAll.addEventListener('change', (e) => {\n                const checkboxes = this.app.querySelectorAll('[data-radio-action=\"selectone\"]');\n                if (e.target.checked) {\n                    checkboxes.forEach((checkbox) => {\n                        checkbox.checked = true;\n                    });\n                } else {\n                    checkboxes.forEach((checkbox) => {\n                        checkbox.checked = false;\n                    });\n                }\n            });\n        }\n        this.app.classList.add('jsenabled');\n    }\n\n    /**\n     * Actions.\n     * @param {object} btn The button that was clicked.\n     */\n    async actions(btn) {\n        if (btn.dataset.buttonAction === 'delete') {\n            this.delete(btn);\n        }\n        if (btn.dataset.buttonAction === 'deleteselected') {\n            this.deleteselected();\n        }\n    }\n\n    /**\n     * Delete a todo by manipulating the state.\n     * @param {object} btn The button that was clicked.\n     */\n    async delete(btn) {\n        let state = CompetState.getData();\n        if (btn.dataset.type === 'todo') {\n            state.todos.find((element) => element.id === parseInt(btn.dataset.id)).deleted = true;\n            CompetState.setData(state);\n            this.deleteTodos();\n        }\n    }\n\n    /**\n     * Delete selected todos.\n     * @return {void}\n     */\n    async deleteselected() {\n        let state = CompetState.getData();\n        let todos = state.todos;\n        let selected = this.app.querySelectorAll('[data-radio-action=\"selectone\"]:checked');\n        selected.forEach((checkbox) => {\n            todos.find((element) => element.id === parseInt(checkbox.dataset.id)).deleted = true;\n        });\n        CompetState.setData(state);\n        this.deleteTodos();\n    }\n\n    /**\n     * Save the state to the server.\n     *\n     * @return {Bool} True if the state was saved.\n     */\n    async deleteTodos() {\n        const state = CompetState.getData();\n        const todoIds = state.todos.filter((todo) => todo.deleted).map((todo) => todo.id);\n        if (!todoIds.length) {\n            return;\n        }\n        await Repository.deleteTodos({todoids: todoIds});\n        this.toggleEmptyTodos();\n    }\n}\n\n/*\n * Initialise\n *\n */\nconst init = () => {\n    new Manager();\n};\n\nexport default {\n    init: init,\n};"],"names":["Manager","constructor","app","document","querySelector","cmId","this","dataset","userId","region","getData","addEventListeners","response","Repository","getTodos","setData","toggleEmptyTodos","hasTodos","CompetState","todos","filter","todo","deleted","length","querySelectorAll","forEach","element","classList","toggle","getAttribute","String","addEventListener","e","btn","target","closest","preventDefault","actions","radioSelectAll","checkboxes","checked","checkbox","add","buttonAction","delete","deleteselected","state","type","find","id","parseInt","deleteTodos","todoIds","map","todoids","init"],"mappings":";;;;;;;;;mMAgCMA,QAKFC,mBACSC,IAAMC,SAASC,cAAc,oCAC7BC,KAAOC,KAAKJ,IAAIK,QAAQF,UACxBG,OAASF,KAAKJ,IAAIK,QAAQC,YAC1BD,QAAUD,KAAKJ,IAAIO,YACnBC,eACAC,0CAOCC,eAAiBC,uBAAWC,SAAS,QAC7BR,KAAKE,SAEdI,gCAGOG,QAAQH,eACfI,oBAMTA,yBAEUC,SADQC,qBAAYR,UACHS,MAAMC,QAAQC,OAAUA,KAAKC,UAASC,OAAS,OACjErB,IAAIsB,iBAAiB,sBAAsBC,SAASC,UACrDA,QAAQC,UAAUC,OAAO,SAAUF,QAAQG,aAAa,sBAAwBC,OAAOb,cAQ/FN,oBACIR,SAAS4B,iBAAiB,SAAUC,QAC5BC,IAAMD,EAAEE,OAAOC,QAAQ,wBACvBF,MACAD,EAAEI,sBACGC,QAAQJ,eAGfK,eAAiBhC,KAAKJ,IAAIE,cAAc,mCAC1CkC,gBAEAA,eAAeP,iBAAiB,UAAWC,UACjCO,WAAajC,KAAKJ,IAAIsB,iBAAiB,mCACzCQ,EAAEE,OAAOM,QACTD,WAAWd,SAASgB,WAChBA,SAASD,SAAU,KAGvBD,WAAWd,SAASgB,WAChBA,SAASD,SAAU,aAK9BtC,IAAIyB,UAAUe,IAAI,2BAObT,KACuB,WAA7BA,IAAI1B,QAAQoC,mBACPC,OAAOX,KAEiB,mBAA7BA,IAAI1B,QAAQoC,mBACPE,8BAQAZ,SACLa,MAAQ5B,qBAAYR,UACC,SAArBuB,IAAI1B,QAAQwC,OACZD,MAAM3B,MAAM6B,MAAMtB,SAAYA,QAAQuB,KAAOC,SAASjB,IAAI1B,QAAQ0C,MAAK3B,SAAU,uBACrEP,QAAQ+B,YACfK,0CASLL,MAAQ5B,qBAAYR,UACpBS,MAAQ2B,MAAM3B,MACHb,KAAKJ,IAAIsB,iBAAiB,2CAChCC,SAASgB,WACdtB,MAAM6B,MAAMtB,SAAYA,QAAQuB,KAAOC,SAAST,SAASlC,QAAQ0C,MAAK3B,SAAU,0BAExEP,QAAQ+B,YACfK,wCAUCC,QADQlC,qBAAYR,UACJS,MAAMC,QAAQC,MAASA,KAAKC,UAAS+B,KAAKhC,MAASA,KAAK4B,KACzEG,QAAQ7B,eAGPV,uBAAWsC,YAAY,CAACG,QAASF,eAClCpC,kCAYE,CACXuC,KALS,SACLvD"}