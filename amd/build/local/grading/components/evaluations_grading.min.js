define("mod_competvet/local/grading/components/evaluations_grading",["../../competstate","core/notification","core/templates","../../new-repository","../../helpers"],(function(_competstate,_notification,_templates,_newRepository,_helpers){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * The grading component of the Evaluations tab.
   *
   * @module     mod_competvet/local/grading/components/evaluations_grading
   * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */_competstate=_interopRequireDefault(_competstate),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_newRepository=_interopRequireDefault(_newRepository);const gradingApp=document.querySelector('[data-region="grading-app"]'),formCalculation=()=>{const form=document.querySelector('[data-region="evaluations-grading"]'),formData=new FormData(form),formObject=Object.fromEntries(formData),grading=_competstate.default.getValue("evaluations-grading").grading;grading.deactivatepenalty="on"===formObject.deactivatepenalty?1:0;let penalty=grading.deactivatepenalty?0:1;penalty=grading.haspenalty*penalty,grading.selfevaluation=formObject.selfevaluation,grading.selfevalselectoptions.forEach((option=>{option.key==Number(formObject.selfevaluation)?option.selected=!0:option.selected=!1})),grading.finalscore=grading.evalscore+grading.penalty*penalty+Number(grading.selfevaluation),grading.scoreevaluator=Number(formObject.scoreevaluator),grading.lettergrade=(0,_helpers.getLetterGrade)(grading.scoreevaluator),grading.comment=formObject.comment,grading.hideaccept=!0,grading.scoreevaluator!==grading.finalscore&&(grading.hideaccept=!1);return{grading:grading}},formEvents=()=>{const form=document.querySelector('[data-region="evaluations-grading"]'),acceptGradeButton=form.querySelector('[data-action="acceptgrade"]');acceptGradeButton&&acceptGradeButton.addEventListener("click",(async e=>{e.preventDefault();const newGrade=form.querySelector(acceptGradeButton.dataset.source).innerHTML;form.querySelector(acceptGradeButton.dataset.target).value=newGrade,form.querySelector('[data-region="lettergrade"]').innerHTML=(0,_helpers.getLetterGrade)(newGrade)})),form.dataset.events||(form.addEventListener("change",(async e=>{e.preventDefault();const context=formCalculation();context.cangrade=1==gradingApp.dataset.cangrade,_competstate.default.setValue("evaluations-grading",context)})),form.addEventListener("submit",(async e=>{e.preventDefault();const context=formCalculation(),user=_competstate.default.getValue("user"),planning=_competstate.default.getValue("planning"),args={userid:user.id,planningid:planning.id,situationid:planning.situationid,formname:"evaluations-grading",json:JSON.stringify(context.grading)},result=await _newRepository.default.saveFormData(args);context.isvalid=result.result,context.isinvalid=!result.result,context.cangrade=1==gradingApp.dataset.cangrade,_competstate.default.setValue("evaluations-grading",context);const subgradeArgs={studentid:user.id,planningid:planning.id,grade:context.grading.scoreevaluator,type:1};await _newRepository.default.setSubGrade(subgradeArgs);const customEvent=new CustomEvent("setSuggestedGrade",{});gradingApp.dispatchEvent(customEvent)})),form.dataset.events=!0)};(()=>{const templateName="evaluations-grading",region=gradingApp.querySelector('[data-region="'.concat(templateName,'"]'));if(!region)return;const template="mod_competvet/grading/components/".concat(templateName);_competstate.default.subscribe(templateName,(context=>{void 0!==context[templateName]&&_templates.default.render(template,context).then((html=>{region.innerHTML=html,formEvents()})).catch(_notification.default.exception)}))})()}));

//# sourceMappingURL=evaluations_grading.min.js.map