define("mod_competvet/local/grading/components/evaluation_chart",["core/str","../../competstate","core/notification","core/templates","core/chartjs"],(function(_str,_competstate,_notification,_templates,_chartjs){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Render the evaluation chart.
   *
   * @module     mod_competvet/local/grading/components/evaluation_chart
   * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */_competstate=_interopRequireDefault(_competstate),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_chartjs=_interopRequireDefault(_chartjs);const gradingApp=document.querySelector('[data-region="grading-app"]'),transformContext=async(context,autoeval)=>{const self=_competstate.default.getValue("user").id;let data=context["evaluation-results"],evaluations=autoeval?data.autoevals:data.observations;evaluations=evaluations.filter((criterion=>criterion.hasaverage));const labels=evaluations.map((criterion=>criterion.criterion.label)),graders=[],colors=["rgba(255, 99, 132, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"],backgroundColors=["rgba(255, 99, 132, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"];let numGraders=0;if(evaluations.forEach((criterion=>{criterion.grades.forEach((grade=>{if(!grade.graderinfo||!grade.graderinfo.id)return;if(autoeval&&grade.graderinfo.id!==self)return;if(!autoeval&&grade.graderinfo.id===self)return;let backgroundColor=backgroundColors.shift();if(autoeval||(backgroundColor="rgba(0, 0, 0, 0)"),!graders[grade.obsid]){const color=colors.shift();graders[grade.obsid]={label:grade.graderinfo.fullname+" ("+grade.date+")",data:[],fill:!0,backgroundColor:backgroundColor,pointRadius:8,bordercolor:color,pointBackgroundColor:color,pointBorderColor:"rgba(255, 255, 255, 1)",pointHoverBackgroundColor:"rgba(255, 255, 255, 1)",pointHoverBorderColor:color},numGraders++}graders[grade.obsid].data.push(grade.level)}))})),!autoeval&&numGraders>1){const average={label:await(0,_str.get_string)("average","mod_competvet"),data:evaluations.map((criterion=>criterion.average)),fill:!0,backgroundColor:"rgba(54, 162, 235, 0.2)",pointRadius:8,bordercolor:"rgba(0, 0, 0, 1)",pointBackgroundColor:"rgba(0, 0, 0, 1)",pointBorderColor:"rgba(255, 255, 255, 1)",pointHoverBackgroundColor:"rgba(255, 255, 255, 1)",pointHoverBorderColor:"rgba(0, 0, 0, 1)"};graders.average=average}return{labels:labels,datasets:Object.values(graders)}},chartConfig=async autoeval=>{let title=await(0,_str.get_string)("supervisorchart","mod_competvet");return autoeval&&(title=await(0,_str.get_string)("selfevaluation","mod_competvet")),{type:"radar",options:{title:{display:!0,text:title,position:"bottom",font:{size:16},fullSize:!0},scales:{r:{ticks:{display:!0,min:0,max:100,stepSize:25,callback:function(value){return 25===value||50===value||75===value||100===value?value:""}},pointLabels:{callback:function(label){return label.length>10?label.substring(0,10)+"...":label}},angleLines:{display:!1},suggestedMin:0,suggestedMax:100}},plugins:{title:{display:!0,text:title,position:"bottom"},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,pointStyle:"circle"}}}}}};(()=>{const region=gradingApp.querySelector('[data-region="'.concat("evaluation-chart",'"]'));if(!region)return;const template="mod_competvet/grading/components/".concat("evaluation-chart");_competstate.default.subscribe("evaluation-chart",(async context=>{void 0!==context["evaluation-chart"]&&_templates.default.render(template,context).then((async html=>{region.innerHTML=html;const evalchart=document.getElementById("evaluation-chart"),config=await chartConfig();config.data=await transformContext(context),config.data.datasets.length>0&&new _chartjs.default(evalchart,config);const autoeval=document.getElementById("auto-evaluation-chart"),autoevalConfig=await chartConfig(!0);autoevalConfig.data=await transformContext(context,!0),autoevalConfig.data.datasets.length>0&&new _chartjs.default(autoeval,autoevalConfig),0===config.data.datasets.length&&0===autoevalConfig.data.datasets.length&&(region.innerHTML="")})).catch(_notification.default.exception)}))})()}));

//# sourceMappingURL=evaluation_chart.min.js.map