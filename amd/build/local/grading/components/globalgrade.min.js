define("mod_competvet/local/grading/components/globalgrade",["../../competstate","core/notification","core/templates","../../new-repository"],(function(_competstate,_notification,_templates,_newRepository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module globalgrade
   *
   * @module     mod_competvet/local/grading/components/globalgrade
   * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */_competstate=_interopRequireDefault(_competstate),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_newRepository=_interopRequireDefault(_newRepository);const gradingApp=document.querySelector('[data-region="grading-app"]'),formEvents=()=>{const form=document.querySelector('[data-region="globalgrade"]'),acceptGradeButton=form.querySelector('[data-action="acceptgrade"]');acceptGradeButton&&acceptGradeButton.addEventListener("click",(async e=>{e.preventDefault(),form.querySelector(acceptGradeButton.dataset.target).value=form.querySelector(acceptGradeButton.dataset.source).innerHTML})),form.dataset.events||(form.addEventListener("submit",(async e=>{e.preventDefault();const globalgrade=(()=>{const form=document.querySelector('[data-region="globalgrade"]'),formData=new FormData(form),formObject=Object.fromEntries(formData),{globalgrade:globalgrade,user:user}=_competstate.default.getData();return globalgrade.userid=user.id,globalgrade.finalgrade=formObject.finalgrade,globalgrade.hideaccept=!0,globalgrade.scoreevaluator!==globalgrade.finalgrade&&(globalgrade.hideaccept=!1),globalgrade.comment=formObject.comment,globalgrade})(),user=_competstate.default.getValue("user"),planning=_competstate.default.getValue("planning"),args={userid:user.id,cmid:planning.cmid,planningid:planning.id,grade:globalgrade.finalgrade,feedback:globalgrade.comment},result=await _newRepository.default.saveGlobalGrade(args);globalgrade.gradesuccess=result.result,globalgrade.gradeerror=!result.result,globalgrade.commentsuccess=result.result,globalgrade.commenterror=!result.result,_competstate.default.setValue("globalgrade",globalgrade)})),form.dataset.events=!0)};(()=>{const region=gradingApp.querySelector('[data-region="'.concat("globalgrade",'"]'));if(!region)return;const template="mod_competvet/grading/components/".concat("globalgrade");_competstate.default.subscribe("globalgrade",(context=>{void 0!==context.globalgrade&&_templates.default.render(template,context).then((html=>{region.innerHTML=html,formEvents()})).catch(_notification.default.exception)}))})()}));

//# sourceMappingURL=globalgrade.min.js.map