{"version":3,"file":"eval_observation_ask.min.js","sources":["../../../src/local/forms/eval_observation_ask.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript adding a new observation.\n *\n * @module     mod_competvet/local/forms/observation_add_form\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport Ajax from 'core/ajax';\nimport Template from \"core/templates\";\nimport {genericForm} from './generic_form_helper';\n\nexport const init = (modulename) => {\n    const handleAskSubmit = async (event) => {\n        const askObservationTitle = await getString('observation:ask', modulename);\n        try {\n            const modal = await ModalFactory.create({\n                title: askObservationTitle,\n                body: Template.render(`${modulename}/view/eval_ask_observation_modal`, {\n                    'modulename': modulename,\n                    ...event.detail\n                }),\n                type: ModalFactory.types.CANCEL,\n                large: true\n            });\n\n            // Show the modal.\n            modal.show();\n            return modal;\n        } catch (error) {\n            await Notification.exception(error);\n        }\n    };\n    genericForm('observation:ask', modulename, 'eval_observation_ask', handleAskSubmit);\n};\n\nexport const initUsersAction = (modulename, planningId, studentId, context) => {\n    const selectedElements = document.querySelectorAll('.ask-observation-modal [data-user-id]');\n    if (!selectedElements) {\n        return;\n    }\n    selectedElements.forEach((element) => {\n        element.addEventListener('click', async (event) => {\n            event.preventDefault();\n            const observationAskedTitle = await getString('observation:asked', modulename);\n            const askEvalPayload = {\n                context: context,\n                planningid: planningId,\n                observerid: element.dataset.userId,\n                studentid: studentId,\n            };\n            try {\n                const askObservationReturn = await Ajax.call(\n                    [{methodname: `${modulename}_ask_eval_observation`, args: askEvalPayload}]\n                )[0];\n                if (askObservationReturn.asked) {\n                    try {\n                        const userInfo = await Ajax.call([\n                            {\n                                methodname: `${modulename}_get_user_profile`,\n                                args: {\n                                    userid: element.dataset.userId,\n                                },\n                            }\n                        ])[0];\n                        const modal = await ModalFactory.create({\n                            title: observationAskedTitle,\n                            body: getString('observation:asked:body', modulename, userInfo.fullname),\n                            type: ModalFactory.types.CANCEL,\n                            large: true\n                        });\n                        element.classList.add('text-success');\n                        modal.show();\n                        return modal;\n                    } catch (error) {\n                        await Notification.exception(error);\n                    }\n                }\n            } catch (error) {\n                const cannotAddString = await getString('todo:cannotadd', modulename);\n                await Notification.exception({message: cannotAddString});\n            }\n        });\n    });\n};\n"],"names":["modulename","async","askObservationTitle","modal","ModalFactory","create","title","body","Template","render","event","detail","type","types","CANCEL","large","show","error","Notification","exception","planningId","studentId","context","selectedElements","document","querySelectorAll","forEach","element","addEventListener","preventDefault","observationAskedTitle","askEvalPayload","planningid","observerid","dataset","userId","studentid","Ajax","call","methodname","args","asked","userInfo","userid","fullname","classList","add","cannotAddString","message"],"mappings":";;;;;;;qTA8BqBA,kDAqBL,kBAAmBA,WAAY,wBApBnBC,MAAAA,cACdC,0BAA4B,mBAAU,kBAAmBF,sBAErDG,YAAcC,uBAAaC,OAAO,CACpCC,MAAOJ,oBACPK,KAAMC,mBAASC,iBAAUT,+CAA8C,YACrDA,cACXU,MAAMC,SAEbC,KAAMR,uBAAaS,MAAMC,OACzBC,OAAO,WAIXZ,MAAMa,OACCb,MACT,MAAOc,aACCC,sBAAaC,UAAUF,qCAMV,CAACjB,WAAYoB,WAAYC,UAAWC,iBACzDC,iBAAmBC,SAASC,iBAAiB,yCAC9CF,kBAGLA,iBAAiBG,SAASC,UACtBA,QAAQC,iBAAiB,SAAS3B,MAAAA,QAC9BS,MAAMmB,uBACAC,4BAA8B,mBAAU,oBAAqB9B,YAC7D+B,eAAiB,CACnBT,QAASA,QACTU,WAAYZ,WACZa,WAAYN,QAAQO,QAAQC,OAC5BC,UAAWf,yBAGwBgB,cAAKC,KACpC,CAAC,CAACC,qBAAevC,oCAAmCwC,KAAMT,kBAC5D,IACuBU,gBAEXC,eAAiBL,cAAKC,KAAK,CAC7B,CACIC,qBAAevC,gCACfwC,KAAM,CACFG,OAAQhB,QAAQO,QAAQC,WAGjC,GACGhC,YAAcC,uBAAaC,OAAO,CACpCC,MAAOwB,sBACPvB,MAAM,mBAAU,yBAA0BP,WAAY0C,SAASE,UAC/DhC,KAAMR,uBAAaS,MAAMC,OACzBC,OAAO,WAEXY,QAAQkB,UAAUC,IAAI,gBACtB3C,MAAMa,OACCb,MACT,MAAOc,aACCC,sBAAaC,UAAUF,QAGvC,MAAOA,aACC8B,sBAAwB,mBAAU,iBAAkB/C,kBACpDkB,sBAAaC,UAAU,CAAC6B,QAASD"}