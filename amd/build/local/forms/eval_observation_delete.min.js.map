{"version":3,"file":"eval_observation_delete.min.js","sources":["../../../src/local/forms/eval_observation_delete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript adding a new observation.\n *\n * @module     mod_competvet/local/forms/observation_add_form\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport {getSelectedElement} from './generic_form_helper';\n\nexport const init = async(modulename) => {\n    const selectedElements = getSelectedElement('observation:delete');\n    if (!selectedElements) {\n        return;\n    }\n    const [deleteTitle, deleteConfirm] = await getStrings([\n        {key: 'observation:delete', component: modulename},\n        {key: 'observation:delete:confirm', component: modulename},\n    ]);\n    selectedElements.forEach((element) => {\n        element.addEventListener('click', async(event) => {\n            event.preventDefault();\n            // Init an ok cancel modal.\n            const modal = await ModalFactory.create({\n                title: deleteTitle,\n                body: deleteConfirm,\n                type: ModalFactory.types.SAVE_CANCEL,\n                large: true\n            }).catch(Notification.exception);\n            modal.getRoot().on(ModalEvents.save, () => {\n                // Query the APO delete_observation from mod_competvet_eval\n                Ajax.call([{\n                    methodname: 'mod_competvet_eval_delete_observation',\n                    args: {\n                        observationid: event.target.dataset.id,\n                    },\n                    done: (data) => {\n                        if (data.success) {\n                            // Close the modal.\n                            modal.hide();\n                            // Reload the page.\n                            window.location.assign(event.target.dataset.returnurl);\n                            window.location.reload();\n                        } else {\n                            Notification.exception({message: data.error});\n                        }\n                    },\n                    fail: Notification.exception\n                }]);\n            });\n            modal.show();\n        });\n    });\n};\n"],"names":["async","selectedElements","deleteTitle","deleteConfirm","key","component","modulename","forEach","element","addEventListener","event","preventDefault","modal","ModalFactory","create","title","body","type","types","SAVE_CANCEL","large","catch","Notification","exception","getRoot","on","ModalEvents","save","call","methodname","args","observationid","target","dataset","id","done","data","success","hide","window","location","assign","returnurl","reload","message","error","fail","show"],"mappings":";;;;;;;kSA8BoBA,MAAAA,mBACVC,kBAAmB,2CAAmB,0BACvCA,8BAGEC,YAAaC,qBAAuB,oBAAW,CAClD,CAACC,IAAK,qBAAsBC,UAAWC,YACvC,CAACF,IAAK,6BAA8BC,UAAWC,cAEnDL,iBAAiBM,SAASC,UACtBA,QAAQC,iBAAiB,SAAST,MAAAA,QAC9BU,MAAMC,uBAEAC,YAAcC,uBAAaC,OAAO,CACpCC,MAAOb,YACPc,KAAMb,cACNc,KAAMJ,uBAAaK,MAAMC,YACzBC,OAAO,IACRC,MAAMC,sBAAaC,WACtBX,MAAMY,UAAUC,GAAGC,sBAAYC,MAAM,mBAE5BC,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,cAAerB,MAAMsB,OAAOC,QAAQC,IAExCC,KAAOC,OACCA,KAAKC,SAELzB,MAAM0B,OAENC,OAAOC,SAASC,OAAO/B,MAAMsB,OAAOC,QAAQS,WAC5CH,OAAOC,SAASG,gCAEHpB,UAAU,CAACqB,QAASR,KAAKS,SAG9CC,KAAMxB,sBAAaC,gBAG3BX,MAAMmC"}